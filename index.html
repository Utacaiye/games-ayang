<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="theme-color" content="#e11d48" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<title>Love Lanes ‚Äî Lane Tap v6.2 üíò</title>
<meta name="description" content="Tap-lane ponsel heart-first. Auto Performance Mode untuk device entry-level.">
<style>
  :root{ --rose:#e11d48; --ink:#7f102a; --hl: rgba(225,29,72,.09); }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Arial, 'Apple Color Emoji','Segoe UI Emoji';
    color:#5b0b1f;
    background: linear-gradient(180deg,#ffe4ea,#ffd9e1 45%,#ffd1da);
    min-height:100svh;
    display:flex;align-items:center;justify-content:center;
    padding-bottom:env(safe-area-inset-bottom);
  }
  .app{width:min(960px,100%);padding:16px}
  .card{background: rgba(255,255,255,.75); backdrop-filter: blur(6px); border-radius: 18px; padding:16px; box-shadow: 0 10px 30px rgba(225,29,72,.15)}
  h1{margin:0 0 4px;font-weight:800;color:var(--ink)}
  .muted{color:#7c3042}

  .btn{border:none; background:var(--rose); color:white; border-radius:14px; padding:12px 16px; font-weight:700; cursor:pointer; box-shadow:0 10px 16px rgba(225,29,72,.25)}
  .btn:hover{filter:brightness(.98)}
  .btn:active{transform:translateY(1px)}

  .hud{display:flex;gap:8px; align-items:center; justify-content:space-between; font-weight:700}
  .badge{background:#ffe3ea; color:#7f102a; padding:6px 10px; border-radius:999px; box-shadow: 0 2px 6px rgba(225,29,72,.12)}
  .badge.strong{background:#e11d48; color:white}

  .stage{position:relative;overflow:hidden;border-radius:16px; box-shadow: inset 0 0 0 1px rgba(225,29,72,.08); background:linear-gradient(180deg,#fff,#ffe9ee); height:60vh; min-height:420px}
  .lanes{position:absolute; inset:0; display:grid; grid-template-columns:repeat(3,1fr); transition:grid-template-columns .2s ease}
  .laneTap{ -webkit-tap-highlight-color: transparent; touch-action:none; transition: background .12s ease }
  .laneTap button{height:100%; width:100%; background:transparent; border:none; outline:none; padding:0; margin:0; -webkit-tap-highlight-color: transparent;}
  .laneTap:active{background:rgba(225,29,72,.05)}
  .laneHL{background: var(--hl) !important;}
  .laneDivider{position:absolute; top:0; bottom:0; width:2px; background:rgba(225,29,72,.08)}

  .obj{position:absolute; left:0; top:0; transform:translate3d(-50%,-50%,0); will-change:transform; pointer-events:none}
  .heart{color:#f43f5e;}
  .bomb{color:#111827;}

  .tapLine{position:absolute; left:0; right:0; height:2px; background:rgba(225,29,72,.25); transform:translateY(-1px); pointer-events:none; opacity:0; transition:opacity .12s}
  .tapLine.show{opacity:1}

  .overlay{position:absolute; inset:0; display:grid; place-items:center; background:rgba(255,255,255,.7)}
  .hidden{display:none !important}
  .footer{margin-top:8px; text-align:center; color:#7c3042}
  svg{display:block}
  .config-grid{display:grid; gap:12px}
  @media(min-width:720px){ .config-grid{grid-template-columns:1fr 1fr 1fr} }
  select.input, input.input{border:1px solid #f8bac6;border-radius:12px;padding:10px 12px;outline:none;width:100%}
  .input:focus{border-color:#fb7185; box-shadow:0 0 0 3px rgba(251,113,133,.25)}

  .row{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
  .switch{display:inline-flex; align-items:center; gap:6px}
  .switch input{accent-color:#e11d48; width:18px; height:18px}

  table{width:100%; border-collapse:collapse; font-size:14px}
  th,td{padding:6px 8px; text-align:left}
  tr+tr td, tr+tr th{border-top:1px solid rgba(225,29,72,.15)}
  th{color:#7c3042}
</style>
</head>
<body>
<div class="app">
  <div class="card" style="margin-bottom:12px">
    <h1>Love Lanes üíù</h1>
    <div class="muted">Akurasi tap <b>heart-first</b>. <b>Performance Mode</b> otomatis di device entry-level.</div>
  </div>

  <div id="config" class="card" style="margin-bottom:12px">
    <div class="config-grid">
      <label>Nama pasangan
        <input id="partnerName" class="input" placeholder="Dinda / Ayang / Sayang" value="Sayangku">
      </label>
      <label>Pesan spesial (muncul saat sukses)
        <input id="specialMsg" class="input" placeholder="Pesan romantis..." value="Kamu selalu jadi alasanku tersenyum. I love you!">
      </label>
      <label>Durasi (detik)
        <input id="duration" class="input" type="number" min="10" value="30">
      </label>
      <label>Mode lajur
        <select id="laneMode" class="input">
          <option value="3" selected>3 Lajur (mudah)</option>
          <option value="4">4 Lajur (menantang)</option>
        </select>
      </label>
      <label>Training mode (tanpa bom)
        <select id="trainingMode" class="input">
          <option value="off" selected>OFF</option>
          <option value="on">ON</option>
        </select>
      </label>
      <div class="row">
        <button id="startBtn" class="btn">Mulai! üíò</button>
        <button id="muteBtn" class="btn" style="background:#7c3042">Sound: ON üîä</button>
        <label class="switch"><input type="checkbox" id="perfMode"> Performance Mode</label>
      </div>
    </div>
    <small class="muted" style="display:block; margin-top:8px">Tip: Ketuk setinggi ‚ù§ untuk akurasi maksimal.</small>
  </div>

  <div class="card stage" id="stage">
    <div class="hud" style="position:absolute; left:12px; right:12px; top:8px; z-index:10">
      <span class="badge strong" id="scoreBadge">Skor: 0</span>
      <span class="badge" id="timeBadge">Waktu: 30s</span>
      <span class="badge" id="bestBadge">Best: 0</span>
    </div>

    <div id="tapLine" class="tapLine"></div>
    <div id="objs" style="position:absolute; inset:0;"></div>
    <div id="lanes" class="lanes"></div>
    <div id="dividers"></div>

    <canvas id="fx" style="position:absolute; inset:0; pointer-events:none;"></canvas>

    <div id="endOverlay" class="overlay hidden">
      <div class="card" style="text-align:center; padding:24px; max-width:560px">
        <div id="endTitle" style="font-size:22px; font-weight:800; margin-bottom:8px">Waktu Habis!</div>
        <div id="endText" class="muted" style="margin-bottom:12px"></div>

        <div style="margin:16px 0; text-align:left">
          <div style="font-weight:800; color:#7c3042; margin-bottom:6px">üèÜ Leaderboard (Top 5)</div>
          <div id="boardWrap"></div>
        </div>

        <div style="display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin-top:10px">
          <button id="shareWA" class="btn" style="background:#16a34a">Share WhatsApp üì§</button>
          <button id="playAgain" class="btn">Main Lagi üíû</button>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">Tip: Add to Home Screen (iOS/Android) untuk pengalaman mirip aplikasi.</div>
</div>

<script>
/* ====== CONFIG ====== */
const THRESHOLD = 20;
const BASE_SPEED = 130, SPEED_SCALE = 2.2;
const SPAWN_BASE = 560, SPAWN_MIN = 300;
const PENALTY = 2;

/* Anti-false-hit */
const TAP_WINDOW = 110, HEART_BIAS = -48, BELOW_TAP_BONUS = -24, ABOVE_TAP_PENALTY = 22, HARD_BELOW_RULE_PAD = 18;

/* ====== DOM ====== */
const $ = (s)=>document.querySelector(s);
const stage = $("#stage"), tapLine = $("#tapLine"), objsEl = $("#objs");
const lanesWrap = $("#lanes"), dividersWrap = $("#dividers");
const scoreBadge = $("#scoreBadge"), timeBadge = $("#timeBadge"), bestBadge = $("#bestBadge");
const startBtn = $("#startBtn"), playAgain = $("#playAgain"), shareBtn = $("#shareWA"), muteBtn = $("#muteBtn");
const endOverlay = $("#endOverlay"), endTitle = $("#endTitle"), endText = $("#endText");
const partnerInput = $("#partnerName"), msgInput = $("#specialMsg"), durInput = $("#duration"), laneMode = $("#laneMode"), trainingMode = $("#trainingMode");
const perfMode = $("#perfMode");
const fx = $("#fx"), fctx = fx.getContext('2d');

/* Auto Performance Mode defaults */
(function autoPerf(){
  try{
    const dm = navigator.deviceMemory || 0; // GB (approx, Chrome-based)
    const hc = navigator.hardwareConcurrency || 0;
    const ua = (navigator.userAgent||'').toLowerCase();
    const isAndroid = ua.includes('android');
    const isIPhone = ua.includes('iphone') || ua.includes('ipod');
    const prefersReducedMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    // heuristik: device RAM <= 3GB, atau core <=4 pada ponsel, atau user prefer reduced motion
    const lowEnd = (dm && dm <= 3) || ((isAndroid||isIPhone) && hc && hc <= 4) || prefersReducedMotion;

    if (lowEnd) {
      perfMode.checked = true;
    }
  }catch(e){ /* ignore */ }
})();

/* DPR & resize */
function fitCanvas(){
  const dpr = Math.min(2, window.devicePixelRatio||1);
  const r = fx.getBoundingClientRect();
  fx.width = Math.floor(r.width * dpr);
  fx.height = Math.floor(r.height * dpr);
  fctx.setTransform(dpr,0,0,dpr,0,0);
}
new ResizeObserver(fitCanvas).observe(stage); fitCanvas();

/* ====== STORAGE ====== */
const store = {
  get best(){ try{ return Number(localStorage.getItem('bestV62')||0) }catch{ return 0 } },
  set best(v){ try{ localStorage.setItem('bestV62', v) }catch{} },
  get board(){ try{ return JSON.parse(localStorage.getItem('boardV62')||'[]') }catch{ return [] } },
  set board(arr){ try{ localStorage.setItem('boardV62', JSON.stringify(arr)) }catch{} }
};
bestBadge.textContent = "Best: " + store.best;

/* ====== AUDIO ====== */
let audioCtx=null, muted=false;
function ensureAudio(){ if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)(); }
async function unlockAudio(){ ensureAudio(); try{ if(audioCtx.state==='suspended') await audioCtx.resume(); }catch{} }
function tone(freq=880, dur=0.06, type='sine', gain=0.12){
  if(muted || perfMode.checked) return; // hemat CPU
  ensureAudio();
  const o = audioCtx.createOscillator(); o.type=type; o.frequency.value=freq;
  const g = audioCtx.createGain(); g.gain.value=gain;
  o.connect(g).connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+dur);
}
function successChord(){
  if(muted || perfMode.checked) return; ensureAudio();
  const freqs=[523,659,784], now=audioCtx.currentTime;
  freqs.forEach((f,i)=>{ const o=audioCtx.createOscillator(), g=audioCtx.createGain();
    o.type='sine'; o.frequency.value=f; g.gain.setValueAtTime(0.0001,now);
    g.gain.exponentialRampToValueAtTime(0.12, now+0.02);
    g.gain.exponentialRampToValueAtTime(0.0001, now+0.35+i*0.02);
    o.connect(g).connect(audioCtx.destination); o.start(now+i*0.02); o.stop(now+0.4+i*0.02);
  });
}
function boom(){
  if(muted || perfMode.checked) return; ensureAudio();
  const bufferSize=audioCtx.sampleRate/2; // lebih pendek
  const noise=audioCtx.createBuffer(1,bufferSize,audioCtx.sampleRate);
  const out=noise.getChannelData(0); for(let i=0;i<bufferSize;i++) out[i]=Math.random()*2-1;
  const src=audioCtx.createBufferSource(); src.buffer=noise;
  const filter=audioCtx.createBiquadFilter(); filter.type='lowpass'; filter.frequency.value=220;
  const g=audioCtx.createGain(); g.gain.value=0.14;
  src.connect(filter).connect(g).connect(audioCtx.destination);
  src.start(); src.stop(audioCtx.currentTime+0.09);
}

/* ====== STATE ====== */
let LANES = 3, laneEls = [];
let state = { running:false, time:30, score:0, spawnTimer:0, lastTs:0, objects:[] };
let idSeq=0;

/* ====== FX PARTICLE SYSTEM (single RAF) ====== */
const MAX_PARTICLES = 140; // sedikit diturunkan
const particles = []; // {x,y,vx,vy,life,size,type}
function addSparkle(x, y){
  if (perfMode.checked) return;
  const N = 9;
  for(let i=0;i<N;i++){
    if (particles.length >= MAX_PARTICLES) particles.shift();
    const ang = (Math.PI*2)*(i/N);
    particles.push({
      x, y,
      vx: Math.cos(ang)*(0.15+Math.random()*0.2),
      vy: Math.sin(ang)*(0.15+Math.random()*0.2),
      life: 320 + Math.random()*120,
      size: 2 + Math.random()*2,
      type: 'spark'
    });
  }
}
function drawParticles(dt){
  if (!particles.length){ fctx.clearRect(0,0,fx.width,fx.height); return; }
  fctx.clearRect(0,0,fx.width,fx.height);
  fctx.fillStyle = '#e11d48';
  for(let i=particles.length-1;i>=0;i--){
    const p = particles[i];
    p.life -= dt;
    if (p.life <= 0){ particles.splice(i,1); continue; }
    p.x += p.vx*dt; p.y += p.vy*dt;
    p.vy += 0.0006*dt;
    const alpha = Math.max(0, p.life/480);
    fctx.globalAlpha = alpha;
    fctx.fillRect(p.x, p.y, p.size, p.size);
  }
  fctx.globalAlpha = 1;
}

/* ====== HELPERS ====== */
function reset(){
  state.running=true;
  state.time=+durInput.value||30;
  state.score=0;
  state.spawnTimer=0;
  state.lastTs=performance.now();
  state.objects.length=0;
  objsEl.innerHTML='';
  scoreBadge.textContent='Skor: 0';
  timeBadge.textContent=`Waktu: ${state.time}s`;
  endOverlay.classList.add('hidden');
  particles.length=0;
  fctx.clearRect(0,0,fx.width,fx.height);
}
function buildLanes(n){
  LANES = n;
  lanesWrap.innerHTML='';
  dividersWrap.innerHTML='';
  lanesWrap.style.gridTemplateColumns = `repeat(${n},1fr)`;
  for(let i=0;i<n;i++){
    const laneTap = document.createElement('div');
    laneTap.className = 'laneTap';
    const btn = document.createElement('button');
    btn.setAttribute('data-lane', String(i));
    btn.setAttribute('aria-label', 'lane '+(i+1));
    laneTap.appendChild(btn);
    lanesWrap.appendChild(laneTap);
  }
  for(let i=1;i<n;i++){
    const div = document.createElement('div');
    div.className='laneDivider';
    div.style.left = (100*(i/n))+'%';
    dividersWrap.appendChild(div);
  }
  laneEls = Array.from(document.querySelectorAll(".laneTap"));
  bindLaneHandlers();
  updateHighlights();
}
function currentHeartRatio(){ return (trainingMode.value === 'on') ? 1.0 : 0.62; }
function spawn(){
  const lane = Math.floor(Math.random()*LANES);
  const type = Math.random()<currentHeartRatio() ? 'heart':'bomb';
  const size = 46 + Math.random()*10; // sedikit lebih kecil
  const speed = BASE_SPEED + Math.min(state.score* SPEED_SCALE, 220);
  const id = ++idSeq;
  state.objects.push({id,lane,y:-size,type,size,speed});
  const xPct = (lane + 0.5) * (100/LANES);
  const el = document.createElement('div');
  el.className='obj '+type;
  el.dataset.id=String(id);
  el.style.left = xPct + '%';
  el.style.top = (-size) + 'px';
  el.innerHTML = type==='heart' ? heartSVG(size) : bombSVG(size);
  objsEl.appendChild(el);
}
function removeObj(id){
  const i = state.objects.findIndex(o=>o.id===id);
  if (i>=0){ state.objects.splice(i,1); }
  const el = objsEl.querySelector(`[data-id="${id}"]`);
  if (el) el.remove();
}
function topmostInLane(lane){
  let top=null;
  for(const o of state.objects){ if(o.lane===lane){ if(!top || o.y>top.y) top=o; } }
  return top;
}

/* ====== PICK (HEART-FIRST) ====== */
function laneTapPick(lane, tapClientY){
  const rect = stage.getBoundingClientRect();
  const tapY = tapClientY - rect.top;
  const cand = state.objects.filter(o => o.lane===lane && Math.abs(o.y - tapY) <= TAP_WINDOW);
  if (!cand.length) return topmostInLane(lane);

  const heartBelow = cand.filter(o => o.type==='heart' && o.y >= tapY - HARD_BELOW_RULE_PAD);
  if (heartBelow.length){
    heartBelow.sort((a,b)=> Math.abs(a.y - tapY) - Math.abs(b.y - tapY));
    return heartBelow[0];
  }
  let best=null, bestScore=Infinity;
  for(const o of cand){
    let score = Math.abs(o.y - tapY);
    if (o.type==='heart') score += HEART_BIAS;
    if (o.type==='heart' && o.y>=tapY) score += BELOW_TAP_BONUS;
    if (o.type==='bomb' && o.y<tapY) score += ABOVE_TAP_PENALTY;
    if (score < bestScore){ bestScore=score; best=o; }
  }
  if (best && best.type==='bomb'){
    const nearestHeart = cand.filter(o=>o.type==='heart').sort((a,b)=>Math.abs(a.y-tapY)-Math.abs(b.y-tapY))[0];
    if (nearestHeart){
      const dHeart = Math.abs(nearestHeart.y - tapY);
      const dBomb = Math.abs(best.y - tapY);
      if (dHeart <= dBomb + 28) return nearestHeart;
    }
  }
  return best || topmostInLane(lane);
}

/* ====== LOOP (single RAF for game + FX) ====== */
function loop(ts){
  if(!state.running) return;
  const dt = Math.min(50, ts - state.lastTs);
  state.lastTs = ts;

  const spawnInterval = Math.max(SPAWN_MIN, SPAWN_BASE - state.score*10);
  state.spawnTimer += dt;
  if (state.spawnTimer >= spawnInterval){
    state.spawnTimer = 0;
    spawn();
  }

  const h = stage.clientHeight;
  for(const o of state.objects){
    o.y += (o.speed * (dt/1000));
    const el = objsEl.querySelector(`[data-id="${o.id}"]`);
    if (el) el.style.top = o.y + 'px';
  }
  for(const o of [...state.objects]) if (o.y > h + o.size*0.6) removeObj(o.id);

  updateHighlights();

  if (Math.floor(ts/1000)!==Math.floor((ts-dt)/1000)){
    state.time--;
    timeBadge.textContent=`Waktu: ${state.time}s`;
    if (state.time<=0){ end(); return; }
  }

  drawParticles(dt);
  requestAnimationFrame(loop);
}

/* ====== END & LEADERBOARD ====== */
function end(){
  state.running=false;
  updateHighlights();
  const partner = partnerInput.value || 'Sayangku';
  const msg = msgInput.value || '';
  const success = state.score >= THRESHOLD;
  endTitle.textContent = success ? `Kamu hebat, ${partner}! üéâ` : 'Waktu Habis! ‚è∞';
  endText.textContent = success ? msg : `${partner}, kamu dapat ${state.score} poin. Yuk coba lagi!`;
  endOverlay.classList.remove('hidden');
  if (success) { successChord(); } else { tone(400,0.2,'sine',0.08); }
  if (state.score > store.best){ store.best = state.score; }
  bestBadge.textContent = 'Best: ' + store.best;

  const item = { score: state.score, lanes: LANES, training: trainingMode.value === 'on', at: new Date().toISOString() };
  const board = store.board; board.push(item);
  board.sort((a,b)=> b.score - a.score || (a.training===b.training?0:(a.training?1:-1)));
  store.board = board.slice(0,5);
  renderBoard(store.board);
}
function renderBoard(list){
  const wrap = document.getElementById('boardWrap');
  if (!list.length){ wrap.innerHTML = '<div class="muted">Belum ada skor.</div>'; return; }
  let html = '<table><thead><tr><th>#</th><th>Skor</th><th>Mode</th><th>Tanggal</th></tr></thead><tbody>';
  list.forEach((it, idx)=>{
    const mode = `${it.lanes} lane${it.lanes>1?'s':''}${it.training?' ‚Ä¢ Training':''}`;
    const date = new Date(it.at).toLocaleString();
    html += `<tr><td>${idx+1}</td><td style="font-weight:800">${it.score}</td><td>${mode}</td><td>${date}</td></tr>`;
  });
  html += '</tbody></table>';
  wrap.innerHTML = html;
}

/* ====== INPUT ====== */
let lastTapTime = 0;
function bindLaneHandlers(){
  laneEls.forEach((laneEl, idx)=>{
    const btn = laneEl.querySelector('button');
    btn.onpointerdown = (e)=>{
      if (!state.running) return;
      const now = performance.now();
      if (now - lastTapTime < 60) return;
      lastTapTime = now;

      unlockAudio();
      const pick = laneTapPick(idx, e.clientY);
      if (!pick) return;

      const rect = stage.getBoundingClientRect();
      tapLine.style.top = (e.clientY - rect.top) + 'px';
      tapLine.classList.add('show');
      setTimeout(()=> tapLine.classList.remove('show'), 70);

      if (pick.type==='heart'){
        state.score++; scoreBadge.textContent='Skor: '+state.score;
        navigator.vibrate?.(6); tone(880,0.045,'sine',0.08);
        popFx(pick);
        const w = fx.width / (window.devicePixelRatio||1);
        const x = (pick.lane + 0.5) * (w / LANES);
        const y = pick.y * (fx.height / stage.clientHeight / (window.devicePixelRatio||1));
        addSparkle(x, y);
      } else {
        if (trainingMode.value === 'on'){
          popFx(pick, true);
        } else {
          state.score = Math.max(0, state.score-PENALTY); scoreBadge.textContent='Skor: '+state.score;
          navigator.vibrate?.([16,18,16]); boom(); popFx(pick, true);
        }
      }
      removeObj(pick.id);
      updateHighlights();
    };
  });
}

/* ====== FX ====== */
function popFx(o, isBomb=false){
  if (perfMode.checked) return;
  const el = document.createElement('div');
  el.style.position='absolute';
  el.style.left = ((o.lane + 0.5) * (100/LANES)) + '%';
  el.style.top = o.y + 'px';
  el.style.transform='translate3d(-50%,-50%,0)';
  el.style.pointerEvents='none';
  el.style.font='700 18px system-ui,-apple-system,Segoe UI,Roboto';
  el.style.color = isBomb ? '#111827' : '#e11d48';
  el.textContent = isBomb? '-2' : '+1';
  el.style.transition='transform .45s ease, opacity .45s ease';
  objsEl.appendChild(el);
  requestAnimationFrame(()=>{
    el.style.opacity='1';
    el.style.transform='translate3d(-50%,-120%,0)';
    el.style.opacity='0';
  });
  setTimeout(()=> el.remove(), 460);
}

/* ====== ICONS ====== */
function heartSVG(size){
  return `<svg class="heart" width="${size}" height="${size}" viewBox="0 0 24 24" fill="currentColor" aria-hidden>
    <path d="M12 21s-7.5-4.438-10-8.25C.81 10.69 1.5 6.5 5 6.5c2.25 0 3.5 1.75 3.5 1.75S9.75 6.5 12 6.5c3.5 0 4.19 4.19 3 6.25C19.5 16.562 12 21 12 21z"/></svg>`;
}
function bombSVG(size){
  return `<svg class="bomb" width="${size}" height="${size}" viewBox="0 0 24 24" fill="currentColor" aria-hidden>
    <circle cx="12" cy="12" r="9"></circle>
    <path d="M14 6c2-2 3.5-1 4.5 0" stroke="#7c3042" stroke-width="2" fill="none" />
    <circle cx="19.5" cy="5" r="1.5" fill="#f59e0b"></circle>
  </svg>`;
}

/* ====== BUTTONS ====== */
startBtn.addEventListener('click', ()=>{ 
  const n = Number(laneMode.value)||3;
  buildLanes(n);
  reset(); 
  requestAnimationFrame(loop); 
});
playAgain?.addEventListener('click', ()=>{ 
  const n = Number(laneMode.value)||3;
  buildLanes(n);
  reset(); 
  requestAnimationFrame(loop); 
});
muteBtn.addEventListener('click', ()=>{
  unlockAudio();
  muted = !muted;
  muteBtn.textContent = muted ? 'Sound: OFF üîá' : 'Sound: ON üîä';
  muteBtn.style.background = muted ? '#9a6d78' : '#7c3042';
});
shareBtn?.addEventListener('click', ()=>{
  const partner = partnerInput.value || 'Sayangku';
  const url = location.href;
  const text = `Aku baru main Love Lanes bareng ${partner} dan skorku ${state.score} üíñ Coba juga ya! ${url}`;
  const wa = 'https://wa.me/?text=' + encodeURIComponent(text);
  window.open(wa, '_blank');
});

// initial lanes
buildLanes(3);
</script>
</body>
</html>
