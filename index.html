<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="theme-color" content="#e11d48" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<title>Love Dash â€” Mobile ğŸ’˜</title>
<meta name="description" content="Mini game romantis untuk ponsel: tangkap hati, hindari bom. Android & iPhone ready.">

<style>
  :root{ --rose:#e11d48; }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Arial, 'Apple Color Emoji','Segoe UI Emoji';
    color:#5b0b1f;
    background: linear-gradient(180deg,#ffe4ea,#ffd9e1 45%,#ffd1da);
    min-height:100svh;
    display:flex;align-items:center;justify-content:center;
    padding-bottom:env(safe-area-inset-bottom);
  }
  .app{width:min(960px,100%);padding:16px}
  .card{background: rgba(255,255,255,.75); backdrop-filter: blur(6px); border-radius: 18px; padding:16px; box-shadow: 0 10px 30px rgba(225,29,72,.15)}
  h1{margin:0 0 4px;font-weight:800;color:#7f102a}
  .muted{color:#7c3042}
  .row{display:grid;gap:12px}
  @media(min-width:700px){.row{grid-template-columns:1fr 1fr}}

  .input{border:1px solid #f8bac6;border-radius:12px;padding:10px 12px;outline:none;width:100%}
  .input:focus{border-color:#fb7185; box-shadow:0 0 0 3px rgba(251,113,133,.25)}

  .btn{border:none; background:var(--rose); color:white; border-radius:14px; padding:12px 16px; font-weight:700; cursor:pointer; box-shadow:0 10px 16px rgba(225,29,72,.25)}
  .btn:hover{filter:brightness(.98)}
  .btn:active{transform:translateY(1px)}

  .hud{display:flex;gap:8px; align-items:center; justify-content:space-between; font-weight:700}
  .badge{background:#ffe3ea; color:#7f102a; padding:6px 10px; border-radius:999px; box-shadow: 0 2px 6px rgba(225,29,72,.12)}
  .badge.strong{background:#e11d48; color:white}
  .center{display:grid;place-items:center}

  .stage{position:relative;overflow:hidden;border-radius:16px; box-shadow: inset 0 0 0 1px rgba(225,29,72,.08)}
  canvas{display:block; width:100%; height:56.25vw; max-height:62vh; min-height:360px; background:linear-gradient(180deg,#fff,#ffe9ee); touch-action:none}
  /* 16:9 responsive height; bounded for small phones */

  .overlay{position:absolute; inset:0; display:grid; place-items:center; background:rgba(255,255,255,.7)}
  .hidden{display:none !important}
  .footer{margin-top:8px; text-align:center; color:#7c3042}
</style>
</head>
<body>
<div class="app">
  <div class="card" style="margin-bottom:12px">
    <h1>Love Dash ğŸ’</h1>
    <div class="muted">Versi ponsel â€” Android & iPhone ready. Tangkap â¤, hindari ğŸ’£.</div>
  </div>

  <div id="config" class="card" style="margin-bottom:12px">
    <div class="row">
      <label>Nama pasangan
        <input id="partnerName" class="input" placeholder="Dinda / Ayang / Sayang" value="Sayangku">
      </label>
      <label>Pesan spesial saat skor tinggi
        <input id="specialMsg" class="input" placeholder="Pesan romantis..." value="Kamu selalu jadi alasanku tersenyum. I love you!">
      </label>
      <label>Ambang skor spesial (angka)
        <input id="specialThreshold" class="input" type="number" min="1" value="20">
      </label>
      <label>Durasi (detik)
        <input id="duration" class="input" type="number" min="10" value="30">
      </label>
    </div>
    <div style="margin-top:10px; display:flex; gap:8px; align-items:center; justify-content:space-between; flex-wrap:wrap">
      <div style="display:flex; gap:8px; align-items:center">
        <button id="startBtn" class="btn">Mulai! ğŸ’˜</button>
        <button id="muteBtn" class="btn" style="background:#7c3042">Sound: ON ğŸ”Š</button>
      </div>
      <small class="muted">Kontrol: geser jari untuk menggerakkan. Tangkap â¤, hindari ğŸ’£. (Mode layar sentuh)</small>
    </div>
  </div>

  <div class="card stage">
    <div class="hud">
      <span class="badge strong" id="scoreBadge">Skor: 0</span>
      <span class="badge" id="timeBadge">Waktu: 30s</span>
      <span class="badge" id="bestBadge">Best: 0</span>
    </div>
    <div style="height:8px"></div>
    <canvas id="game" width="960" height="540"></canvas>

    <div id="endOverlay" class="overlay hidden">
      <div class="card center" style="text-align:center; padding:24px">
        <div id="endTitle" style="font-size:22px; font-weight:800; margin-bottom:8px">Waktu Habis!</div>
        <div id="endText" class="muted" style="margin-bottom:12px"></div>
        <button id="playAgain" class="btn">Main Lagi ğŸ’</button>
      </div>
    </div>
  </div>

  <div class="footer">Tip: Tambahkan ke Home Screen di iPhone (Shareâ†’Add to Home Screen) atau Android (Add to Home Screen).</div>
</div>

<script>
/* =========================
   RESPONSIVE CANVAS SCALING (HiDPI)
   ========================= */
const $ = (sel) => document.querySelector(sel);
const canvas = $("#game");
const ctx = canvas.getContext("2d", { alpha:false, desynchronized:true });
function fitCanvas(){
  const dpr = Math.min(2, window.devicePixelRatio || 1); // cap DPR for perf
  const rect = canvas.getBoundingClientRect();
  canvas.width = Math.floor(rect.width * dpr);
  canvas.height = Math.floor(rect.height * dpr);
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
new ResizeObserver(fitCanvas).observe(canvas);
window.addEventListener('orientationchange', ()=> setTimeout(fitCanvas, 250));
fitCanvas();

/* =========================
   SAFE SCROLL / TOUCH
   ========================= */
document.addEventListener('touchmove', (e)=>{
  if (e.target === canvas) e.preventDefault(); // prevent scroll/bounce when playing
},{ passive:false });
document.body.style.overscrollBehavior = 'contain';

/* =========================
   UI ELEMENTS
   ========================= */
const partnerInput = $("#partnerName");
const specialMsgInput = $("#specialMsg");
const thresholdInput = $("#specialThreshold");
const durationInput = $("#duration");
const startBtn = $("#startBtn");
const muteBtn = $("#muteBtn");
const scoreBadge = $("#scoreBadge");
const timeBadge = $("#timeBadge");
const bestBadge = $("#bestBadge");
const endOverlay = $("#endOverlay");
const endTitle = $("#endTitle");
const endText = $("#endText");
const playAgain = $("#playAgain");

const store = {
  get best(){ try{ return Number(localStorage.getItem("loveDashBest")||0) }catch{ return 0 } },
  set best(v){ try{ localStorage.setItem("loveDashBest", v) }catch{} }
};
bestBadge.textContent = "Best: " + store.best;

/* =========================
   AUDIO â€” MOBILE FRIENDLY
   ========================= */
let audioCtx = null;
let soundMuted = false;
function ensureAudio(){
  if(!audioCtx){
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
}
async function unlockAudio(){
  ensureAudio();
  try{
    if (audioCtx.state === 'suspended') { await audioCtx.resume(); }
    const b = audioCtx.createBuffer(1, 1, audioCtx.sampleRate);
    const s = audioCtx.createBufferSource(); s.buffer = b;
    s.connect(audioCtx.destination); s.start(0); s.stop(0);
  }catch{}
}
function beep(freq=880, dur=0.08, type="sine", gain=0.12){
  if(soundMuted) return;
  ensureAudio();
  const osc = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  osc.frequency.value = freq; osc.type = type;
  g.gain.value = gain;
  osc.connect(g).connect(audioCtx.destination);
  osc.start();
  osc.stop(audioCtx.currentTime + dur);
}
function chordSuccess(){
  if(soundMuted) return;
  ensureAudio();
  const freqs = [523,659,784]; // C-E-G
  const now = audioCtx.currentTime;
  freqs.forEach((f,i)=>{
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = "sine"; o.frequency.value = f;
    g.gain.setValueAtTime(0.0001, now);
    g.gain.exponentialRampToValueAtTime(0.12, now+0.02);
    g.gain.exponentialRampToValueAtTime(0.0001, now+0.35+i*0.02);
    o.connect(g).connect(audioCtx.destination);
    o.start(now + i*0.02);
    o.stop(now + 0.4 + i*0.02);
  });
}
function boom(){
  if(soundMuted) return;
  ensureAudio();
  const bufferSize = 2 * audioCtx.sampleRate;
  const noiseBuffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
  const output = noiseBuffer.getChannelData(0);
  for (let i = 0; i < bufferSize; i++) output[i] = Math.random() * 2 - 1;
  const white = audioCtx.createBufferSource(); white.buffer = noiseBuffer;
  const filter = audioCtx.createBiquadFilter(); filter.type = "lowpass"; filter.frequency.value = 220;
  const g = audioCtx.createGain(); g.gain.value = 0.22;
  white.connect(filter).connect(g).connect(audioCtx.destination);
  white.start(); white.stop(audioCtx.currentTime + 0.2);
}
function bgPulseStart(){
  if(soundMuted) return;
  ensureAudio();
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = "triangle"; o.frequency.value = 120;
  g.gain.value = 0.03;
  o.connect(g).connect(audioCtx.destination);
  o.start();
  bgPulse.stop = ()=>{ try{o.stop()}catch{} };
  const lfo = audioCtx.createOscillator(); lfo.frequency.value = 2.2;
  const lfoGain = audioCtx.createGain(); lfoGain.gain.value = 12;
  lfo.connect(lfoGain); lfoGain.connect(o.frequency);
  lfo.start();
  bgPulse.stopLfo = ()=>{ try{lfo.stop()}catch{} };
}
const bgPulse = { stop(){}, stopLfo(){} };

/* =========================
   GAME LOGIC
   ========================= */
const state = {
  running:false,
  time:30,
  score:0,
  player:{ x: canvas.width/2, y: canvas.height-42, w:84, h:28 },
  objects:[], // falling items
};
let lastTs = 0;

function reset(){
  state.time = +durationInput.value || 30;
  state.score = 0;
  state.objects = [];
  state.player.x = canvas.width/2;
  scoreBadge.textContent = "Skor: 0";
  timeBadge.textContent = `Waktu: ${state.time}s`;
}

function start(){
  reset();
  state.running = true;
  endOverlay.classList.add("hidden");
  lastTs = performance.now();
  bgPulseStart();
  requestAnimationFrame(loop);
}

function end(){
  state.running = false;
  bgPulse.stop(); bgPulse.stopLfo();
  const partner = partnerInput.value || "Sayangku";
  const th = Number(thresholdInput.value || 20);
  const spMsg = specialMsgInput.value || "";
  const success = state.score >= th;
  endTitle.textContent = success ? `Kamu hebat, ${partner}! ğŸ‰` : "Waktu Habis! â°";
  endText.textContent = success ? spMsg : `${partner}, kamu dapat ${state.score} poin. Yuk coba lagi biar tembus ${th}!`;
  endOverlay.classList.remove("hidden");
  if (success) chordSuccess(); else beep(400,0.2,"sine",0.08);
  if (state.score > store.best){ store.best = state.score; }
  bestBadge.textContent = "Best: " + store.best;
}

function spawn(){
  const isHeart = Math.random() < 0.62;
  const size = isHeart ? 26 + Math.random()*12 : 24 + Math.random()*12;
  const speed = 1.5 + Math.random()*1.5 + Math.min(state.score*0.02, 1.2);
  state.objects.push({
    type: isHeart ? "heart" : "bomb",
    x: 40 + Math.random()*(canvas.width-80),
    y: -size-10,
    size, speed,
    swayPhase: Math.random()*Math.PI*2
  });
}

function loop(ts){
  if(!state.running) return;
  const dt = Math.min(32, ts - lastTs);
  lastTs = ts;

  // spawn rhythm (adaptive)
  if (Math.random() < 0.02 + Math.min(state.score*0.0008, 0.015)) spawn();

  // update objects
  state.objects.forEach(o=>{
    o.y += o.speed;
    o.x += Math.sin(ts/600 + o.swayPhase) * 0.5;
  });
  state.objects = state.objects.filter(o=> o.y < canvas.height + 50);

  // countdown (once per second)
  if (Math.floor(ts/1000) !== Math.floor((ts-dt)/1000)) {
    state.time--;
    timeBadge.textContent = `Waktu: ${state.time}s`;
    if (state.time<=5 && state.time>0) beep(900,0.05,"square",0.06);
    if (state.time<=0){ end(); return; }
  }

  render();
  requestAnimationFrame(loop);
}

function render(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  drawPlayer(state.player.x, state.player.y, state.player.w, state.player.h);

  for(const o of state.objects){
    if (o.type==="heart") drawHeart(o.x,o.y,o.size);
    else drawBomb(o.x,o.y,o.size);

    // collision
    if (hit(o, state.player)){
      if (o.type==="heart"){ state.score++; navigator.vibrate?.(8); beep(880,0.06,"sine",0.08); }
      else { state.score = Math.max(0, state.score - 2); navigator.vibrate?.([24,28,24]); boom(); }
      scoreBadge.textContent = "Skor: " + state.score;
      state.objects.splice(state.objects.indexOf(o),1);
    }
  }
}

function hit(o,p){
  const halfW = p.w/2;
  return o.x > p.x - halfW && o.x < p.x + halfW && o.y + o.size*0.5 > p.y - 10 && o.y - o.size*0.5 < p.y + p.h;
}

/* =========================
   DRAWING
   ========================= */
function roundRect(ctx,x,y,w,h,r){
  const rr = Math.min(r, w/2, h/2);
  ctx.beginPath();
  ctx.moveTo(x+rr,y);
  ctx.arcTo(x+w,y,x+w,y+h,rr);
  ctx.arcTo(x+w,y+h,x,y+h,rr);
  ctx.arcTo(x,y+h,x,y,rr);
  ctx.arcTo(x,y,x+w,y,rr);
  ctx.closePath();
}
function drawPlayer(x,y,w,h){
  ctx.save(); ctx.translate(x,y);
  ctx.fillStyle = "rgba(225,29,72,.95)";
  roundRect(ctx, -w/2, -h/2, w, h, 14); ctx.fill();
  ctx.fillStyle = "rgba(255,255,255,.9)";
  roundRect(ctx, -w/4, -h/4, w/6, h/2, 6); ctx.fill();
  ctx.restore();
}
function drawHeart(x,y,size){
  ctx.save(); ctx.translate(x,y); ctx.fillStyle = "#f43f5e";
  const s = size/24;
  ctx.beginPath();
  ctx.moveTo(12*s,21*s);
  ctx.bezierCurveTo(-12*s,7*s, 4*s,-4*s, 12*s,5*s);
  ctx.bezierCurveTo(20*s,-4*s, 36*s,7*s, 12*s,21*s);
  ctx.closePath(); ctx.fill(); ctx.restore();
}
function drawBomb(x,y,size){
  ctx.save(); ctx.translate(x,y);
  const r = size/2;
  ctx.fillStyle = "#111827";
  ctx.beginPath(); ctx.arc(0,0,r,0,Math.PI*2); ctx.fill();
  ctx.strokeStyle = "#7c3042"; ctx.lineWidth = 3;
  ctx.beginPath(); ctx.moveTo(r*0.2,-r*0.6); ctx.quadraticCurveTo(r*0.8,-r*1.1, r*1.2,-r*1.5); ctx.stroke();
  ctx.fillStyle = "#f59e0b"; ctx.beginPath(); ctx.arc(r*1.25,-r*1.55, r*0.18, 0, Math.PI*2); ctx.fill();
  ctx.restore();
}

/* =========================
   INPUT â€” TOUCH FIRST
   ========================= */
let pointerId = null;
function moveToClient(clientX){
  const rect = canvas.getBoundingClientRect();
  const x = Math.max(32, Math.min(rect.width-32, clientX - rect.left));
  const canvasX = x * (canvas.width/rect.width);
  state.player.x = canvasX;
}
canvas.addEventListener("pointerdown", async (e)=>{
  pointerId = e.pointerId;
  canvas.setPointerCapture(pointerId);
  await unlockAudio();
  moveToClient(e.clientX);
});
canvas.addEventListener("pointermove", (e)=>{
  if (pointerId === e.pointerId) moveToClient(e.clientX);
}, { passive:true });
canvas.addEventListener("pointerup", (e)=>{
  if (pointerId === e.pointerId){ canvas.releasePointerCapture(pointerId); pointerId=null; }
}, { passive:true });

/* =========================
   UI BUTTONS
   ========================= */
startBtn.addEventListener("click", async ()=>{
  await unlockAudio();
  start();
});
playAgain.addEventListener("click", async ()=>{
  await unlockAudio();
  start();
});
muteBtn.addEventListener("click", async ()=>{
  await unlockAudio();
  soundMuted = !soundMuted;
  muteBtn.textContent = soundMuted ? "Sound: OFF ğŸ”‡" : "Sound: ON ğŸ”Š";
  muteBtn.style.background = soundMuted ? "#9a6d78" : "#7c3042";
});

</script>
</body>
</html>
